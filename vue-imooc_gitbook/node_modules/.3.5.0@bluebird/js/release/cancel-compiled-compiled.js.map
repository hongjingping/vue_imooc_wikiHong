{"version":3,"sources":["cancel-compiled.js"],"names":[],"mappings":"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","file":"cancel-compiled-compiled.js","sourcesContent":["\"use strict\";\n\nmodule.exports = function (Promise, PromiseArray, apiRejection, debug) {\n    var util = require(\"./util\");\n    var tryCatch = util.tryCatch;\n    var errorObj = util.errorObj;\n    var async = Promise._async;\n\n    Promise.prototype[\"break\"] = Promise.prototype.cancel = function () {\n        if (!debug.cancellation()) return this._warn(\"cancellation is disabled\");\n\n        var promise = this;\n        var child = promise;\n        while (promise._isCancellable()) {\n            if (!promise._cancelBy(child)) {\n                if (child._isFollowing()) {\n                    child._followee().cancel();\n                } else {\n                    child._cancelBranched();\n                }\n                break;\n            }\n\n            var parent = promise._cancellationParent;\n            if (parent == null || !parent._isCancellable()) {\n                if (promise._isFollowing()) {\n                    promise._followee().cancel();\n                } else {\n                    promise._cancelBranched();\n                }\n                break;\n            } else {\n                if (promise._isFollowing()) promise._followee().cancel();\n                promise._setWillBeCancelled();\n                child = promise;\n                promise = parent;\n            }\n        }\n    };\n\n    Promise.prototype._branchHasCancelled = function () {\n        this._branchesRemainingToCancel--;\n    };\n\n    Promise.prototype._enoughBranchesHaveCancelled = function () {\n        return this._branchesRemainingToCancel === undefined || this._branchesRemainingToCancel <= 0;\n    };\n\n    Promise.prototype._cancelBy = function (canceller) {\n        if (canceller === this) {\n            this._branchesRemainingToCancel = 0;\n            this._invokeOnCancel();\n            return true;\n        } else {\n            this._branchHasCancelled();\n            if (this._enoughBranchesHaveCancelled()) {\n                this._invokeOnCancel();\n                return true;\n            }\n        }\n        return false;\n    };\n\n    Promise.prototype._cancelBranched = function () {\n        if (this._enoughBranchesHaveCancelled()) {\n            this._cancel();\n        }\n    };\n\n    Promise.prototype._cancel = function () {\n        if (!this._isCancellable()) return;\n        this._setCancelled();\n        async.invoke(this._cancelPromises, this, undefined);\n    };\n\n    Promise.prototype._cancelPromises = function () {\n        if (this._length() > 0) this._settlePromises();\n    };\n\n    Promise.prototype._unsetOnCancel = function () {\n        this._onCancelField = undefined;\n    };\n\n    Promise.prototype._isCancellable = function () {\n        return this.isPending() && !this._isCancelled();\n    };\n\n    Promise.prototype.isCancellable = function () {\n        return this.isPending() && !this.isCancelled();\n    };\n\n    Promise.prototype._doInvokeOnCancel = function (onCancelCallback, internalOnly) {\n        if (util.isArray(onCancelCallback)) {\n            for (var i = 0; i < onCancelCallback.length; ++i) {\n                this._doInvokeOnCancel(onCancelCallback[i], internalOnly);\n            }\n        } else if (onCancelCallback !== undefined) {\n            if (typeof onCancelCallback === \"function\") {\n                if (!internalOnly) {\n                    var e = tryCatch(onCancelCallback).call(this._boundValue());\n                    if (e === errorObj) {\n                        this._attachExtraTrace(e.e);\n                        async.throwLater(e.e);\n                    }\n                }\n            } else {\n                onCancelCallback._resultCancelled(this);\n            }\n        }\n    };\n\n    Promise.prototype._invokeOnCancel = function () {\n        var onCancelCallback = this._onCancel();\n        this._unsetOnCancel();\n        async.invoke(this._doInvokeOnCancel, this, onCancelCallback);\n    };\n\n    Promise.prototype._invokeInternalOnCancel = function () {\n        if (this._isCancellable()) {\n            this._doInvokeOnCancel(this._onCancel(), true);\n            this._unsetOnCancel();\n        }\n    };\n\n    Promise.prototype._resultCancelled = function () {\n        this.cancel();\n    };\n};\n\n//# sourceMappingURL=cancel-compiled.js.map"]}