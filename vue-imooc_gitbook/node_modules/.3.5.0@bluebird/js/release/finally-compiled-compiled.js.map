{"version":3,"sources":["finally-compiled.js"],"names":[],"mappings":"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","file":"finally-compiled-compiled.js","sourcesContent":["\"use strict\";\n\nmodule.exports = function (Promise, tryConvertToPromise, NEXT_FILTER) {\n    var util = require(\"./util\");\n    var CancellationError = Promise.CancellationError;\n    var errorObj = util.errorObj;\n    var catchFilter = require(\"./catch_filter\")(NEXT_FILTER);\n\n    function PassThroughHandlerContext(promise, type, handler) {\n        this.promise = promise;\n        this.type = type;\n        this.handler = handler;\n        this.called = false;\n        this.cancelPromise = null;\n    }\n\n    PassThroughHandlerContext.prototype.isFinallyHandler = function () {\n        return this.type === 0;\n    };\n\n    function FinallyHandlerCancelReaction(finallyHandler) {\n        this.finallyHandler = finallyHandler;\n    }\n\n    FinallyHandlerCancelReaction.prototype._resultCancelled = function () {\n        checkCancel(this.finallyHandler);\n    };\n\n    function checkCancel(ctx, reason) {\n        if (ctx.cancelPromise != null) {\n            if (arguments.length > 1) {\n                ctx.cancelPromise._reject(reason);\n            } else {\n                ctx.cancelPromise._cancel();\n            }\n            ctx.cancelPromise = null;\n            return true;\n        }\n        return false;\n    }\n\n    function succeed() {\n        return finallyHandler.call(this, this.promise._target()._settledValue());\n    }\n    function fail(reason) {\n        if (checkCancel(this, reason)) return;\n        errorObj.e = reason;\n        return errorObj;\n    }\n    function finallyHandler(reasonOrValue) {\n        var promise = this.promise;\n        var handler = this.handler;\n\n        if (!this.called) {\n            this.called = true;\n            var ret = this.isFinallyHandler() ? handler.call(promise._boundValue()) : handler.call(promise._boundValue(), reasonOrValue);\n            if (ret === NEXT_FILTER) {\n                return ret;\n            } else if (ret !== undefined) {\n                promise._setReturnedNonUndefined();\n                var maybePromise = tryConvertToPromise(ret, promise);\n                if (maybePromise instanceof Promise) {\n                    if (this.cancelPromise != null) {\n                        if (maybePromise._isCancelled()) {\n                            var reason = new CancellationError(\"late cancellation observer\");\n                            promise._attachExtraTrace(reason);\n                            errorObj.e = reason;\n                            return errorObj;\n                        } else if (maybePromise.isPending()) {\n                            maybePromise._attachCancellationCallback(new FinallyHandlerCancelReaction(this));\n                        }\n                    }\n                    return maybePromise._then(succeed, fail, undefined, this, undefined);\n                }\n            }\n        }\n\n        if (promise.isRejected()) {\n            checkCancel(this);\n            errorObj.e = reasonOrValue;\n            return errorObj;\n        } else {\n            checkCancel(this);\n            return reasonOrValue;\n        }\n    }\n\n    Promise.prototype._passThrough = function (handler, type, success, fail) {\n        if (typeof handler !== \"function\") return this.then();\n        return this._then(success, fail, undefined, new PassThroughHandlerContext(this, type, handler), undefined);\n    };\n\n    Promise.prototype.lastly = Promise.prototype[\"finally\"] = function (handler) {\n        return this._passThrough(handler, 0, finallyHandler, finallyHandler);\n    };\n\n    Promise.prototype.tap = function (handler) {\n        return this._passThrough(handler, 1, finallyHandler);\n    };\n\n    Promise.prototype.tapCatch = function (handlerOrPredicate) {\n        var len = arguments.length;\n        if (len === 1) {\n            return this._passThrough(handlerOrPredicate, 1, undefined, finallyHandler);\n        } else {\n            var catchInstances = new Array(len - 1),\n                j = 0,\n                i;\n            for (i = 0; i < len - 1; ++i) {\n                var item = arguments[i];\n                if (util.isObject(item)) {\n                    catchInstances[j++] = item;\n                } else {\n                    return Promise.reject(new TypeError(\"tapCatch statement predicate: \" + \"expecting an object but got \" + util.classString(item)));\n                }\n            }\n            catchInstances.length = j;\n            var handler = arguments[i];\n            return this._passThrough(catchFilter(catchInstances, handler, this), 1, undefined, finallyHandler);\n        }\n    };\n\n    return PassThroughHandlerContext;\n};\n\n//# sourceMappingURL=finally-compiled.js.map"]}