{"version":3,"sources":["../got/index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["'use strict';\nconst EventEmitter = require('events');\nconst http = require('http');\nconst https = require('https');\nconst PassThrough = require('stream').PassThrough;\nconst urlLib = require('url');\nconst querystring = require('querystring');\nconst duplexer3 = require('duplexer3');\nconst isStream = require('is-stream');\nconst getStream = require('get-stream');\nconst timedOut = require('timed-out');\nconst urlParseLax = require('url-parse-lax');\nconst lowercaseKeys = require('lowercase-keys');\nconst isRedirect = require('is-redirect');\nconst unzipResponse = require('unzip-response');\nconst createErrorClass = require('create-error-class');\nconst isRetryAllowed = require('is-retry-allowed');\nconst Buffer = require('safe-buffer').Buffer;\nconst pkg = require('./package');\n\nfunction requestAsEventEmitter(opts) {\n\topts = opts || {};\n\n\tconst ee = new EventEmitter();\n\tconst requestUrl = opts.href || urlLib.resolve(urlLib.format(opts), opts.path);\n\tlet redirectCount = 0;\n\tlet retryCount = 0;\n\tlet redirectUrl;\n\n\tconst get = opts => {\n\t\tconst fn = opts.protocol === 'https:' ? https : http;\n\n\t\tconst req = fn.request(opts, res => {\n\t\t\tconst statusCode = res.statusCode;\n\n\t\t\tif (isRedirect(statusCode) && opts.followRedirect && 'location' in res.headers && (opts.method === 'GET' || opts.method === 'HEAD')) {\n\t\t\t\tres.resume();\n\n\t\t\t\tif (++redirectCount > 10) {\n\t\t\t\t\tee.emit('error', new got.MaxRedirectsError(statusCode, opts), null, res);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst bufferString = Buffer.from(res.headers.location, 'binary').toString();\n\n\t\t\t\tredirectUrl = urlLib.resolve(urlLib.format(opts), bufferString);\n\t\t\t\tconst redirectOpts = Object.assign({}, opts, urlLib.parse(redirectUrl));\n\n\t\t\t\tee.emit('redirect', res, redirectOpts);\n\n\t\t\t\tget(redirectOpts);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsetImmediate(() => {\n\t\t\t\tconst response = typeof unzipResponse === 'function' && req.method !== 'HEAD' ? unzipResponse(res) : res;\n\t\t\t\tresponse.url = redirectUrl || requestUrl;\n\t\t\t\tresponse.requestUrl = requestUrl;\n\n\t\t\t\tee.emit('response', response);\n\t\t\t});\n\t\t});\n\n\t\treq.once('error', err => {\n\t\t\tconst backoff = opts.retries(++retryCount, err);\n\n\t\t\tif (backoff) {\n\t\t\t\tsetTimeout(get, backoff, opts);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tee.emit('error', new got.RequestError(err, opts));\n\t\t});\n\n\t\tif (opts.gotTimeout) {\n\t\t\ttimedOut(req, opts.gotTimeout);\n\t\t}\n\n\t\tsetImmediate(() => {\n\t\t\tee.emit('request', req);\n\t\t});\n\t};\n\n\tget(opts);\n\treturn ee;\n}\n\nfunction asPromise(opts) {\n\treturn new Promise((resolve, reject) => {\n\t\tconst ee = requestAsEventEmitter(opts);\n\n\t\tee.on('request', req => {\n\t\t\tif (isStream(opts.body)) {\n\t\t\t\topts.body.pipe(req);\n\t\t\t\topts.body = undefined;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treq.end(opts.body);\n\t\t});\n\n\t\tee.on('response', res => {\n\t\t\tconst stream = opts.encoding === null ? getStream.buffer(res) : getStream(res, opts);\n\n\t\t\tstream\n\t\t\t\t.catch(err => reject(new got.ReadError(err, opts)))\n\t\t\t\t.then(data => {\n\t\t\t\t\tconst statusCode = res.statusCode;\n\t\t\t\t\tconst limitStatusCode = opts.followRedirect ? 299 : 399;\n\n\t\t\t\t\tres.body = data;\n\n\t\t\t\t\tif (opts.json && res.body) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tres.body = JSON.parse(res.body);\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tthrow new got.ParseError(e, statusCode, opts, data);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (statusCode < 200 || statusCode > limitStatusCode) {\n\t\t\t\t\t\tthrow new got.HTTPError(statusCode, opts);\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve(res);\n\t\t\t\t})\n\t\t\t\t.catch(err => {\n\t\t\t\t\tObject.defineProperty(err, 'response', {value: res});\n\t\t\t\t\treject(err);\n\t\t\t\t});\n\t\t});\n\n\t\tee.on('error', reject);\n\t});\n}\n\nfunction asStream(opts) {\n\tconst input = new PassThrough();\n\tconst output = new PassThrough();\n\tconst proxy = duplexer3(input, output);\n\n\tif (opts.json) {\n\t\tthrow new Error('got can not be used as stream when options.json is used');\n\t}\n\n\tif (opts.body) {\n\t\tproxy.write = () => {\n\t\t\tthrow new Error('got\\'s stream is not writable when options.body is used');\n\t\t};\n\t}\n\n\tconst ee = requestAsEventEmitter(opts);\n\n\tee.on('request', req => {\n\t\tproxy.emit('request', req);\n\n\t\tif (isStream(opts.body)) {\n\t\t\topts.body.pipe(req);\n\t\t\treturn;\n\t\t}\n\n\t\tif (opts.body) {\n\t\t\treq.end(opts.body);\n\t\t\treturn;\n\t\t}\n\n\t\tif (opts.method === 'POST' || opts.method === 'PUT' || opts.method === 'PATCH') {\n\t\t\tinput.pipe(req);\n\t\t\treturn;\n\t\t}\n\n\t\treq.end();\n\t});\n\n\tee.on('response', res => {\n\t\tconst statusCode = res.statusCode;\n\n\t\tres.pipe(output);\n\n\t\tif (statusCode < 200 || statusCode > 299) {\n\t\t\tproxy.emit('error', new got.HTTPError(statusCode, opts), null, res);\n\t\t\treturn;\n\t\t}\n\n\t\tproxy.emit('response', res);\n\t});\n\n\tee.on('redirect', proxy.emit.bind(proxy, 'redirect'));\n\tee.on('error', proxy.emit.bind(proxy, 'error'));\n\n\treturn proxy;\n}\n\nfunction normalizeArguments(url, opts) {\n\tif (typeof url !== 'string' && typeof url !== 'object') {\n\t\tthrow new Error(`Parameter \\`url\\` must be a string or object, not ${typeof url}`);\n\t}\n\n\tif (typeof url === 'string') {\n\t\turl = url.replace(/^unix:/, 'http://$&');\n\t\turl = urlParseLax(url);\n\n\t\tif (url.auth) {\n\t\t\tthrow new Error('Basic authentication must be done with auth option');\n\t\t}\n\t}\n\n\topts = Object.assign(\n\t\t{\n\t\t\tprotocol: 'http:',\n\t\t\tpath: '',\n\t\t\tretries: 5\n\t\t},\n\t\turl,\n\t\topts\n\t);\n\n\topts.headers = Object.assign({\n\t\t'user-agent': `${pkg.name}/${pkg.version} (https://github.com/sindresorhus/got)`,\n\t\t'accept-encoding': 'gzip,deflate'\n\t}, lowercaseKeys(opts.headers));\n\n\tconst query = opts.query;\n\n\tif (query) {\n\t\tif (typeof query !== 'string') {\n\t\t\topts.query = querystring.stringify(query);\n\t\t}\n\n\t\topts.path = `${opts.path.split('?')[0]}?${opts.query}`;\n\t\tdelete opts.query;\n\t}\n\n\tif (opts.json && opts.headers.accept === undefined) {\n\t\topts.headers.accept = 'application/json';\n\t}\n\n\tlet body = opts.body;\n\n\tif (body) {\n\t\tif (typeof body !== 'string' && !(body !== null && typeof body === 'object')) {\n\t\t\tthrow new Error('options.body must be a ReadableStream, string, Buffer or plain Object');\n\t\t}\n\n\t\topts.method = opts.method || 'POST';\n\n\t\tif (isStream(body) && typeof body.getBoundary === 'function') {\n\t\t\t// Special case for https://github.com/form-data/form-data\n\t\t\topts.headers['content-type'] = opts.headers['content-type'] || `multipart/form-data; boundary=${body.getBoundary()}`;\n\t\t} else if (body !== null && typeof body === 'object' && !Buffer.isBuffer(body) && !isStream(body)) {\n\t\t\topts.headers['content-type'] = opts.headers['content-type'] || 'application/x-www-form-urlencoded';\n\t\t\tbody = opts.body = querystring.stringify(body);\n\t\t}\n\n\t\tif (opts.headers['content-length'] === undefined && opts.headers['transfer-encoding'] === undefined && !isStream(body)) {\n\t\t\tconst length = typeof body === 'string' ? Buffer.byteLength(body) : body.length;\n\t\t\topts.headers['content-length'] = length;\n\t\t}\n\t}\n\n\topts.method = (opts.method || 'GET').toUpperCase();\n\n\tif (opts.hostname === 'unix') {\n\t\tconst matches = /(.+):(.+)/.exec(opts.path);\n\n\t\tif (matches) {\n\t\t\topts.socketPath = matches[1];\n\t\t\topts.path = matches[2];\n\t\t\topts.host = null;\n\t\t}\n\t}\n\n\tif (typeof opts.retries !== 'function') {\n\t\tconst retries = opts.retries;\n\n\t\topts.retries = (iter, err) => {\n\t\t\tif (iter > retries || !isRetryAllowed(err)) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tconst noise = Math.random() * 100;\n\n\t\t\treturn ((1 << iter) * 1000) + noise;\n\t\t};\n\t}\n\n\tif (opts.followRedirect === undefined) {\n\t\topts.followRedirect = true;\n\t}\n\n\tif (opts.timeout) {\n\t\topts.gotTimeout = opts.timeout;\n\t\tdelete opts.timeout;\n\t}\n\n\treturn opts;\n}\n\nfunction got(url, opts) {\n\ttry {\n\t\treturn asPromise(normalizeArguments(url, opts));\n\t} catch (err) {\n\t\treturn Promise.reject(err);\n\t}\n}\n\nconst helpers = [\n\t'get',\n\t'post',\n\t'put',\n\t'patch',\n\t'head',\n\t'delete'\n];\n\nhelpers.forEach(el => {\n\tgot[el] = (url, opts) => got(url, Object.assign({}, opts, {method: el}));\n});\n\ngot.stream = (url, opts) => asStream(normalizeArguments(url, opts));\n\nfor (const el of helpers) {\n\tgot.stream[el] = (url, opts) => got.stream(url, Object.assign({}, opts, {method: el}));\n}\n\nfunction stdError(error, opts) {\n\tif (error.code !== undefined) {\n\t\tthis.code = error.code;\n\t}\n\n\tObject.assign(this, {\n\t\tmessage: error.message,\n\t\thost: opts.host,\n\t\thostname: opts.hostname,\n\t\tmethod: opts.method,\n\t\tpath: opts.path\n\t});\n}\n\ngot.RequestError = createErrorClass('RequestError', stdError);\ngot.ReadError = createErrorClass('ReadError', stdError);\ngot.ParseError = createErrorClass('ParseError', function (e, statusCode, opts, data) {\n\tstdError.call(this, e, opts);\n\tthis.statusCode = statusCode;\n\tthis.statusMessage = http.STATUS_CODES[this.statusCode];\n\tthis.message = `${e.message} in \"${urlLib.format(opts)}\": \\n${data.slice(0, 77)}...`;\n});\n\ngot.HTTPError = createErrorClass('HTTPError', function (statusCode, opts) {\n\tstdError.call(this, {}, opts);\n\tthis.statusCode = statusCode;\n\tthis.statusMessage = http.STATUS_CODES[this.statusCode];\n\tthis.message = `Response code ${this.statusCode} (${this.statusMessage})`;\n});\n\ngot.MaxRedirectsError = createErrorClass('MaxRedirectsError', function (statusCode, opts) {\n\tstdError.call(this, {}, opts);\n\tthis.statusCode = statusCode;\n\tthis.statusMessage = http.STATUS_CODES[this.statusCode];\n\tthis.message = 'Redirected 10 times. Aborting.';\n});\n\nmodule.exports = got;\n"]}